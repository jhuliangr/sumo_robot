#include <WString.h>
#include "control_page.h"

String getControlPage() {
  String html = R"rawliteral(
  <!DOCTYPE html><html><head><title>Sumo Kart</title> <meta name="viewport" content="width=device-width, initial-scale=1"><style>*{margin:0;padding:0;box-sizing:border-box;}body{background:linear-gradient(90deg, #000000 0%, #01ff3c 100%);padding:10px;color:white;}.container{background:rgba(255, 255, 255, 0.1);padding:10px;border-radius:15px;backdrop-filter: blur(10px);display:flex;flex-direction:column;}.status{background:rgba(255, 255, 255, 0.2);padding:15px;border-radius:10px;margin:10px 0;text-align:center;}.joystick-container{position:relative;width:200px;height:200px;background:rgba(255, 255, 255, 0.2);border-radius:50%;border:3px solid white;margin-top:10px;}.joystick{position:absolute;width:60px;height:60px;background:#4CAF50;border-radius:50%;top:70px;left:70px;cursor:pointer;touch-action:none;border:3px solid black;box-shadow:1px 1px 10px 1px;}.controls{display:flex;flex-direction:column;align-items:center;justify-content:center;max-width:300px;}button{margin:5px;border:none;border-radius:5px;background:#4CAF50;color:black;cursor:pointer;font-size:16px;border:solid 1px;}.stop{background:#f44336;padding-inline:10px;padding-block:10px;}.connection-info{background:rgba(0, 0, 0, 0.3);padding:10px;border-radius:5px;margin:10px 0;font-size:14px;text-align:center;}.speed-control{display:flex;align-items:center;justify-content:center;gap:10px;width:50vw;}.speed-slider{width:80%;padding:10px;}.forward{border-top-left-radius:40px;border-top-right-radius:40px;padding-block:30px;padding-inline:30px;}.backwards{border-bottom-left-radius:40px;border-bottom-right-radius:40px;padding-block:30px;padding-inline:30px;}.left{border-bottom-left-radius:40px;border-top-left-radius:40px;padding-block:30px;padding-inline:30px;}.right{border-bottom-right-radius:40px;border-top-right-radius:40px;padding-block:30px;padding-inline:30px;}.centered{display:flex;justify-content:space-between;align-items:center;}.info{display:flex;justify-content:space-between;flex:1;}.speed-joystick-container{position:relative;width:100px;height:200px;background:rgba(255, 255, 255, 0.2);border-radius:50px;border:3px solid white;margin-top:10px;overflow:hidden;}.speed-joystick{position:absolute;width:90px;height:90px;background:#48ff4e;border-radius:10px;left:5px;top:55px;cursor:pointer;touch-action:none;border:3px solid black;box-shadow:1px 1px 10px 1px;z-index:2;}.speed-track{position:absolute;width:50px;height:180px;background:rgba(0, 0, 0, 0.3);border-radius:25px;left:25px;top:10px;z-index:1;}@media(max-width: 600px){.info{flex-direction:column;align-items:center;justify-content:center;}.controls{max-width:100%;margin-top:20px;}}</style></head><body><div class="container"><div class="info"><div class="connection-info"><div><strong>Connected to:</strong> Jhulian's Kart</div></div><div class="speed-control"><label>Max Speed: <span id="speedValue"> </label><button style="width: 100px; height: 50px; background-color: red;" onclick="redOn()">Red</button><button style="width: 100px; height: 50px; background-color: lime;" onclick="greenOn()">Green</button></div></div></div><div class="info"><div class="joystick-container" id="joystickArea"><div class="joystick" id="joystick"></div></div><div class="controls"><div class="centered"><button style="width: 100px; height: 50px; background-color: rgb(255, 55, 0); color: white" onclick="brakes()">Brakes</button><button style="width: 100px; height: 50px; background-color: rgb(0, 21, 160); color: white" onclick="autoAttack()">autoAttack</button><div class="speed-joystick-container" id="speedJoystickArea"><div class="speed-track"></div><div class="speed-joystick" id="speedJoystick"></div></div></div></div></div></div><script>let socketConn=new WebSocket("ws://"+location.hostname+":81/");const joystick=document.getElementById('joystick');const container=document.getElementById('joystickArea');let isDragging=false;let maxSpeed=200;joystick.addEventListener('mousedown',startDrag);document.addEventListener('mousemove',drag);document.addEventListener('mouseup',stopDrag);joystick.addEventListener('touchstart',startDrag);document.addEventListener('touchmove',drag);document.addEventListener('touchend',stopDrag);const speedJoystick=document.getElementById('speedJoystick');const speedContainer=document.getElementById('speedJoystickArea');let isSpeedDragging=false;let currentSpeed=200;document.getElementById('speedValue').textContent=currentSpeed;speedJoystick.addEventListener('mousedown',startSpeedDrag);document.addEventListener('mousemove',speedDrag);document.addEventListener('mouseup',stopSpeedDrag);speedJoystick.addEventListener('touchstart',startSpeedDrag);document.addEventListener('touchmove',speedDrag);document.addEventListener('touchend',stopSpeedDrag);function startDrag(e){e.preventDefault();isDragging=true}function drag(e){if(!isDragging)return;e.preventDefault();const rect=container.getBoundingClientRect();const centerX=rect.left+rect.width/2;const centerY=rect.top+rect.height/2;let clientX,clientY;if(e.type==='touchmove'){clientX=e.touches[0].clientX;clientY=e.touches[0].clientY}else{clientX=e.clientX;clientY=e.clientY}let relX=clientX-centerX;let relY=clientY-centerY;const maxDist=rect.width/2-30;const dist=Math.min(Math.sqrt(relX*relX+relY*relY),maxDist);if(dist>0){const angle=Math.atan2(relY,relX);relX=Math.cos(angle)*dist;relY=Math.sin(angle)*dist}joystick.style.left=(rect.width/2+relX-30)+'px';joystick.style.top=(rect.height/2+relY-30)+'px';const normX=relX/maxDist;const normY=relY/maxDist;let dir='stop';let speed=Math.min(Math.sqrt(normX*normX+normY*normY)*maxSpeed,maxSpeed);if(speed>10){const angle=Math.atan2(normY,normX)*180/Math.PI;if(angle>=-45&&angle<45)dir='right';else if(angle>=45&&angle<135)dir='backward';else if(angle>=135||angle<-135)dir='left';else dir='forward';if(Math.abs(normX)>0.3&&Math.abs(normY)>0.3){if(normY<-0.3){if(normX>0.3)dir='right';else dir='left';}}}socketConn.send(`${dir}:${Math.round(speed)}`)}function stopDrag(){if(!isDragging)return;isDragging=false;joystick.style.left='70px';joystick.style.top='70px'}function startSpeedDrag(e){e.preventDefault();isSpeedDragging=true}function speedDrag(e){if(!isSpeedDragging)return;e.preventDefault();const rect=speedContainer.getBoundingClientRect();const minY=rect.top+5;const maxY=rect.top+rect.height-35;let clientY;if(e.type==='touchmove'){clientY=e.touches[0].clientY}else{clientY=e.clientY}let newY=Math.max(minY,Math.min(clientY,maxY));const relativeY=(newY-minY)/(maxY-minY);const speedFactor=1-relativeY;currentSpeed=Math.round(speedFactor*255);const joystickY=newY-rect.top-45;speedJoystick.style.top=joystickY+'px';maxSpeed=currentSpeed;document.getElementById('speedValue').textContent=currentSpeed}function stopSpeedDrag(){if(!isSpeedDragging)return;isSpeedDragging=false}const brakes=()=>socketConn.send("stop");const redOn=()=>fetch('/red',{method:'GET',headers:{'Content-Type':'application/x-www-form-urlencoded'}});const greenOn=()=>fetch('/green',{method:'GET',headers:{'Content-Type':'application/x-www-form-urlencoded'}});const autoAttack=()=>fetch('/auto',{method:'GET',headers:{'Content-Type':'application/x-www-form-urlencoded'}});</script></body></html>
  )rawliteral";
  return html;
}